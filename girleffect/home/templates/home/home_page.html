{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags static %}

{% block content %}
    {# Hero section - section includes links #}
    {% include "includes/hero_video_section.html" %}

    {# Introduction #}
    <p class="large-text">{{ page.introduction }}</p>
    
    {# Homepage Carousel #}
    {% if page.carousel_items.exists %}
    <div class="carousel carousel--home-desktop">
        <h4 class="carousel__home-title">{{ page.overview_title }}</h4>
        {% image page.overview_image fill-1600x800 as overview_image %}
        <img class="carousel__image carousel__image--main" src="{{ overview_image.url }}">

        {% for item in page.carousel_items.all %}
            {% image item.image fill-1600x800 as carousel_item_image %}
            <img data-image="{{ forloop.counter }}" class="carousel__image carousel__image--hidden" src="{{ carousel_item_image.url }}">
        {% endfor %}

        <div class="carousel__panels">
            {% for item in page.carousel_items.all %}

                {% if item.link_page %}
                    <a data-panel="{{ forloop.counter }}" class="carousel__panel" href="{{ item.link_page.url }}">
                {% elif item.link_url %}
                    <a data-panel="{{ forloop.counter }}" class="carousel__panel" href="{{ item.link_url }}">
                {% else %}
                    <div data-panel="{{ forloop.counter }}" class="carousel__panel">
                {% endif %}

                        <svg class="carousel__icon">
                            <use xlink:href="#chevron"></use>
                        </svg>

                        <h4 class="carousel__panel-title">{{ item.title }}</h4>
                        <div class="carousel__panel-content">
                            <p>{{ item.description }}</p>
                            
                            {% if item.link_page %}
                                <span class="link link--with-arrow">
                                    {{ item.link_text|default:item.title }}
                                    <div class="arrow"></div>
                                </span>
                            {% elif item.link_url %}
                                <span class="link link--with-arrow">
                                    {{ item.link_text|default:item.title }}
                                    <div class="arrow"></div>
                                </span>
                            {% endif %}
                        </div>

                {% if item.link_page %}
                    </a>
                {% elif item.link_url %}
                    </a>
                {% else %}
                    </div>
                {% endif %}
            {% endfor %}
        </div>
    </div>

    <div class="carousel carousel--home-mobile">
        <div class="js-carousel--home-mobile owl-carousel">
            {% for item in page.carousel_items.all %}

                <div class="carousel__panel-mobile">
                    <h4 class="carousel__home-title">{{ page.overview_title }}</h4>
                    {% image item.image fill-720x400 as carousel_item_image %}
                    <img src="{{ carousel_item_image.url }}">

                    <div class="carousel__panel-content-mobile">
                        <h4 class="carousel__panel-title">{{ item.title }}</h4>
                        <div class="carousel__panel-content">
                            <p>{{ item.description }}</p>
                            {% if item.link_page %}
                                <a class="link link--with-arrow" href="{{ item.link_page.url }}">
                                    {{ item.link_text|default:item.title }}
                                    <div class="arrow"></div>
                                </a>
                                {% elif item.link_url %}
                                <a class="link link--with-arrow" href="{{ item.link_url }}">
                                    {{ item.link_text|default:item.title }}
                                    <div class="arrow"></div>
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>

            {% endfor %}
        </div>
    </div>
    {% endif %}
        
    {# Streamfield options #}
    <section class="section section--body">
        {{ page.body }}
    </section>

    {# Latest articles, limited to three most recent, link to all articles index #}
    {% include "includes/articles_section.html" with title="Latest News &amp; Stories" %}

    {# Call to Action, link is likely external #}
    {% if page.call_to_action %}
        <section class="cta">
            {% include "includes/call_to_action.html" %}
        </section>
    {% endif %}

{% endblock %}
